#!/bin/bash

source "${0%/*}/dev-utils.sh"

## #ddev-generated
## Description: Run CSpell on custom modules and themes files
# Usage: ddev dev-cspell [--all] [--files=file1.php,file2.js]
# Example: "ddev dev-cspell" (checks git diff)
#          "ddev dev-cspell --all" (checks all files)
#          "ddev dev-cspell --files=file1.php,file2.js" (checks specific files)

set -euo pipefail

# Define extensions for text files
EXTENSIONS=("php" "module" "js" "css" "twig" "yml" "yaml" "json" "md" "txt")

# Get files based on extensions and arguments
if [ $# -eq 0 ]; then
    # No arguments - use git diff
    FILES=$(get_files "${EXTENSIONS[@]}")
else
    # Pass all arguments to get_files along with extensions
    FILES=$(get_files "${EXTENSIONS[@]}" "$@")
fi

if [ -z "${FILES:-}" ]; then
    echo "‚ùå No files to check"
    exit 0
fi

echo "üîç Running CSpell on files:"
echo "$FILES" | tr ' ' '\n'

if [ -f "./.cspell.json" ]; then
    echo "Using local .cspell.json"
    CONFIG="./.cspell.json"
else
    CONFIG="docroot/core/.cspell.json"
fi

node docroot/core/node_modules/cspell/bin.mjs --config "$CONFIG" --color $FILES
